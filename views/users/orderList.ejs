<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders - SeatWorld</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="/css/users/profile.css">
    <link rel="stylesheet" href="/css/users/addressList.css"> <!-- reusing sidebar styles -->
    <link rel="stylesheet" href="/css/users/orderList.css">
</head>

<body class="bg-gray-100 text-gray-800">

    <!-- Overlay -->

    <!-- Mobile Menu Button -->
    <%- include('../partials/profileMobileToggle') %>

        <%- include('../partials/header', { showSearch: false }) %>
            <%- include("../partials/breadcrumb", { breadcrumbs }) %>

                <!-- MAIN -->
                <main class="profile-container">

                    <div class="profile-layout">


                        <!-- SIDEBAR -->
                        <%- include('../partials/profileSidebar', { active: 'orders' }) %>


                            <!-- ORDER LIST CONTENT -->
                            <section class="main-content">

                                <div class="bg-white rounded-lg border shadow-sm p-6">

                                    <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                                        <h1 class="text-2xl font-bold text-gray-800">My Orders</h1>
                                        <div class="flex flex-col md:flex-row items-center gap-4 w-full md:w-auto">
                                            <!-- Search Bar -->
                                            <div class="relative w-full md:w-64">
                                                <span
                                                    class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                    <i class="fas fa-search text-gray-400"></i>
                                                </span>
                                                <input type="text" id="orderSearch"
                                                    class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-full leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-black focus:border-black sm:text-sm"
                                                    placeholder="Search orders or products..."
                                                    value="<%= search || '' %>">
                                            </div>
                                            <div class="hidden md:block relative">
                                                <span
                                                    class="px-4 py-2 bg-gray-200 rounded-full text-sm font-medium">Last
                                                    6
                                                    months</span>
                                            </div>
                                        </div>
                                    </div>

                                    <% if (orders && orders.length> 0) { %>
                                        <div class="overflow-x-auto">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>Order ID</th>
                                                        <th>Items</th>
                                                        <th>Date</th>
                                                        <th>Total Amount</th>
                                                        <th>Order Status</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% orders.forEach(order=> { %>
                                                        <tr>
                                                            <td>#<%= order._id.toString().slice(-6).toUpperCase() %>
                                                            </td>
                                                            <td class="items-cell">
                                                                <span class="item-count">
                                                                    <%= order.itemCount %> Items
                                                                </span>
                                                                <div class="item-ids">
                                                                    <% order.items.forEach(item=> { %>
                                                                        <span class="item-id-badge">
                                                                            #<%= item._id.toString().slice(-6).toUpperCase()
                                                                                %>
                                                                        </span>
                                                                        <% }) %>
                                                                </div>
                                                            </td>
                                                            <td class="date-cell">
                                                                <%= new
                                                                    Date(order.createdAt).toLocaleDateString('en-GB') %>
                                                            </td>
                                                            <td class="amount-cell">â‚¹<%=
                                                                    order.totalAmount.toLocaleString('en-IN') %>
                                                            </td>
                                                            <td>
                                                                <div class="status-wrapper">
                                                                    <% let statusClass='pending' ; const
                                                                        lowerStatus=order.orderStatus.toLowerCase(); if
                                                                        (lowerStatus.includes('delivered'))
                                                                        statusClass='delivered' ; else if
                                                                        (lowerStatus.includes('cancelled') ||
                                                                        lowerStatus.includes('returned'))
                                                                        statusClass='cancelled' ; else if
                                                                        (lowerStatus.includes('shipped'))
                                                                        statusClass='shipped' ; %>
                                                                        <span
                                                                            class="status-indicator <%= statusClass %>"></span>
                                                                        <div>
                                                                            <p class="status-text">
                                                                                <%= order.orderStatus %>
                                                                            </p>
                                                                            <% if (['pending', 'confirmed' , 'shipped'
                                                                                ].includes(order.orderStatus)) { %>
                                                                                <p class="status-subtext">
                                                                                    Delivery expected by <%= new
                                                                                        Date(new
                                                                                        Date(order.createdAt).getTime()
                                                                                        +
                                                                                        5*24*60*60*1000).toLocaleDateString('en-GB')
                                                                                        %>
                                                                                </p>
                                                                                <% } else if
                                                                                    (order.orderStatus==='cancelled' ) {
                                                                                    %>
                                                                                    <p class="status-subtext cancelled">
                                                                                        Your order has been cancelled.
                                                                                    </p>
                                                                                    <% } %>
                                                                        </div>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <a href="/orders/<%= order._id %>"
                                                                    class="view-order-btn">
                                                                    View Order
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        <% }) %>
                                                </tbody>
                                            </table>
                                        </div>

                                        <!-- Pagination Section -->
                                        <div class="pagination-wrapper">
                                            <div class="pagination-info">
                                                Showing <span class="font-medium">
                                                    <%= (pagination.currentPage - 1) * pagination.limit + 1 %>
                                                </span> to
                                                <span class="font-medium">
                                                    <%= Math.min(pagination.currentPage * pagination.limit,
                                                        pagination.totalOrders) %>
                                                </span> of
                                                <span class="font-medium">
                                                    <%= pagination.totalOrders %>
                                                </span> results
                                            </div>
                                            <%- include('../partials/pagination', { pagination, query: 'search=' +
                                                (search || '' ) }) %>
                                        </div>

                                        <% } else { %>
                                            <div class="empty-state">
                                                <span class="material-icons-outlined">shopping_bag</span>
                                                <p>You haven't placed any orders yet.</p>
                                                <a href="/products">Start Shopping</a>
                                            </div>
                                            <% } %>

                                </div>
                            </section>
                    </div>
                </main>


                <%- include('../partials/footer') %>

                    <!-- Shared Sidebar Scripts -->
                    <script type="module" src="/js/users/addressList.js"></script>

                    <script type="module" src="/js/users/orderList.js"></script>
</body>

</html>