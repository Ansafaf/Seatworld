<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders - SeatWorld</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="/css/users/profile.css">
    <link rel="stylesheet" href="/css/users/addressList.css"> <!-- reusing sidebar styles -->
</head>

<body class="bg-gray-100 text-gray-800">

    <!-- Overlay -->

    <!-- Mobile Menu Button -->
    <%- include('../partials/profileMobileToggle') %>

        <%- include('../partials/header', { showSearch: false }) %>
            <%- include("../partials/breadcrumb", { breadcrumbs }) %>

                <!-- MAIN -->
                <main class="container">

                    <div class="profile-layout">


                        <!-- SIDEBAR -->
                        <%- include('../partials/profileSidebar', { active: 'orders' }) %>


                            <!-- ORDER LIST CONTENT -->
                            <section class="main-content">

                                <div class="bg-white rounded-lg border shadow-sm p-6">

                                    <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                                        <h1 class="text-2xl font-bold text-gray-800">My Orders</h1>
                                        <div class="flex flex-col md:flex-row items-center gap-4 w-full md:w-auto">
                                            <!-- Search Bar -->
                                            <div class="relative w-full md:w-64">
                                                <span
                                                    class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                    <i class="fas fa-search text-gray-400"></i>
                                                </span>
                                                <input type="text" id="orderSearch"
                                                    class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-full leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-black focus:border-black sm:text-sm"
                                                    placeholder="Search orders or products..."
                                                    value="<%= search || '' %>">
                                            </div>
                                            <div class="hidden md:block relative">
                                                <span
                                                    class="px-4 py-2 bg-gray-200 rounded-full text-sm font-medium">Last
                                                    6
                                                    months</span>
                                            </div>
                                        </div>
                                    </div>

                                    <% if (orders && orders.length> 0) { %>
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-left border-collapse">
                                                <thead>
                                                    <tr
                                                        class="border-b bg-gray-50 text-sm font-semibold text-gray-600 uppercase tracking-wider">
                                                        <th class="px-4 py-3">Order ID</th>
                                                        <th class="px-4 py-3">Items</th>
                                                        <th class="px-4 py-3">Date</th>
                                                        <th class="px-4 py-3">Total Amount</th>
                                                        <th class="px-4 py-3">Order Status</th>
                                                        <th class="px-4 py-3">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="text-sm divide-y divide-gray-100">
                                                    <% orders.forEach(order=> { %>
                                                        <tr class="hover:bg-gray-50 transition-colors">
                                                            <td class="px-4 py-4 font-medium text-gray-900">#<%=
                                                                    order._id.toString().slice(-6).toUpperCase() %>
                                                            </td>
                                                            <td class="px-4 py-4">
                                                                <div class="flex flex-col">
                                                                    <span class="font-bold text-gray-900">
                                                                        <%= order.itemCount %> Items
                                                                    </span>
                                                                    <div class="flex flex-wrap gap-1 mt-1">
                                                                        <% order.items.forEach(item=> { %>
                                                                            <span
                                                                                class="text-[9px] bg-gray-100 px-1.5 py-0.5 rounded text-gray-400 font-mono tracking-tighter uppercase">
                                                                                #<%= item._id.toString().slice(-6).toUpperCase()
                                                                                    %>
                                                                            </span>
                                                                            <% }) %>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                            <td class="px-4 py-4">
                                                                <%= new
                                                                    Date(order.createdAt).toLocaleDateString('en-GB') %>
                                                            </td>
                                                            <td class="px-4 py-4 font-semibold">â‚¹<%=
                                                                    order.totalAmount.toLocaleString('en-IN') %>
                                                            </td>
                                                            <td class="px-4 py-4">
                                                                <div class="flex items-start gap-2">
                                                                    <% let statusColor='bg-yellow-400' ; if
                                                                        (order.orderStatus==='delivered' )
                                                                        statusColor='bg-green-500' ; else if
                                                                        (['cancelled', 'returned'
                                                                        ].includes(order.orderStatus))
                                                                        statusColor='bg-red-500' ; else if
                                                                        (order.orderStatus==='shipped' )
                                                                        statusColor='bg-blue-500' ; %>
                                                                        <span
                                                                            class="mt-1.5 w-2 h-2 rounded-full <%= statusColor %>"></span>
                                                                        <div>
                                                                            <p
                                                                                class="font-medium text-gray-900 capitalize">
                                                                                <%= order.orderStatus %>
                                                                            </p>
                                                                            <% if (['pending', 'confirmed' , 'shipped'
                                                                                ].includes(order.orderStatus)) { %>
                                                                                <p class="text-xs text-gray-500">
                                                                                    Delivery
                                                                                    expected by <%= new Date(new
                                                                                        Date(order.createdAt).getTime()
                                                                                        +
                                                                                        5*24*60*60*1000).toLocaleDateString('en-GB')
                                                                                        %>
                                                                                </p>
                                                                                <% } else if
                                                                                    (order.orderStatus==='cancelled' ) {
                                                                                    %>
                                                                                    <p class="text-xs text-red-500">Your
                                                                                        order has been cancelled.</p>
                                                                                    <% } %>
                                                                        </div>
                                                                </div>
                                                            </td>
                                                            <td class="px-4 py-4">
                                                                <a href="/orders/<%= order._id %>"
                                                                    class="inline-block px-4 py-2 bg-black text-white text-xs font-bold rounded hover:bg-gray-800 transition-colors">
                                                                    View Order
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        <% }) %>
                                                </tbody>
                                            </table>
                                        </div>

                                        <!-- Pagination Section -->
                                        <div class="mt-6 flex flex-col items-center">
                                            <span class="text-sm text-gray-500 mb-4">
                                                Showing <span class="font-medium">
                                                    <%= (pagination.currentPage - 1) * pagination.limit + 1 %>
                                                </span> to <span class="font-medium">
                                                    <%= Math.min(pagination.currentPage * pagination.limit,
                                                        pagination.totalOrders) %>
                                                </span> of <span class="font-medium">
                                                    <%= pagination.totalOrders %>
                                                </span> results
                                            </span>
                                            <%- include('../partials/pagination', { pagination, query: 'search=' +
                                                (search || '' ) }) %>
                                        </div>

                                        <% } else { %>
                                            <div class="text-center py-20">
                                                <span class="material-icons-outlined text-gray-300"
                                                    style="font-size: 60px;">shopping_bag</span>
                                                <p class="text-gray-500 mt-4 text-lg">You haven't placed any orders yet.
                                                </p>
                                                <a href="/"
                                                    class="inline-block mt-6 px-6 py-3 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors font-medium">Start
                                                    Shopping</a>
                                            </div>
                                            <% } %>

                                </div>
                            </section>
                    </div>
                </main>


                <%- include('../partials/footer') %>

                    <!-- Shared Sidebar Scripts -->
                    <script type="module" src="/js/users/addressList.js"></script>

                    <script type="module" src="/js/users/orderList.js"></script>
</body>

</html>