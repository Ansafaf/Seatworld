<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Cart - SeatWorld</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/users/cartList.css">
  <script src="/js/common/pagination.js" defer></script>
</head>

<body>

  <%- include('../partials/header', { showSearch: false }) %>
    <%- include("../partials/breadcrumb", { breadcrumbs }) %>

      <main class="page-container">
        <h1 class="page-title">YOUR CART</h1>

        <div class="cart-layout">
          <!-- Cart Items Section -->
          <div class="cart-items-column">
            <% if (cartItems && cartItems.length> 0) { %>
              <div class="items-list">
                <% cartItems.forEach(item=> { %>
                  <div class="cart-item-card" data-variant-id="<%= item.variantId._id %>">
                    <div class="item-visual">
                      <img src="<%= item.image %>" alt="<%= item.name %>">
                    </div>
                    <div class="item-info">
                      <div class="info-top">
                        <h3 class="item-name">
                          <%= item.name %>
                        </h3>
                        <button class="remove-item-btn" onclick="removeItem('<%= item.variantId._id %>')"
                          aria-label="Remove item">
                          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                            </path>
                          </svg>
                        </button>
                      </div>
                      <p class="item-meta">Color: <span>
                          <%= item.color %>
                        </span></p>

                      <% if (item.outOfStock) { %>
                        <p class="stock-badge out-of-stock">Out of Stock</p>
                        <% } else if (item.stock < 5) { %>
                          <p class="stock-badge low-stock">Only <%= item.stock %> left</p>
                          <% } %>

                            <div class="info-bottom">
                              <span class="item-price">₹<%= item.price %></span>
                              <div class="quantity-pill">
                                <button class="qty-btn minus" onclick="updateQty('<%= item.variantId._id %>', -1)"
                                  <%=item.quantity <=1 ? 'disabled' : '' %>>
                                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                  </svg>
                                </button>
                                <span class="qty-value">
                                  <%= item.quantity %>
                                </span>
                                <button class="qty-btn plus" onclick="updateQty('<%= item.variantId._id %>', 1)"
                                  <%=item.quantity>= item.stock ? 'disabled' : '' %>>
                                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                  </svg>
                                </button>
                              </div>
                            </div>
                    </div>
                  </div>
                  <% }) %>
              </div>
              <% } else { %>
                <div class="empty-cart-state">
                  <div class="empty-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                      stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="9" cy="21" r="1"></circle>
                      <circle cx="20" cy="21" r="1"></circle>
                      <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                  </div>
                  <h2>Your cart is empty</h2>
                  <p>Looks like you haven't added anything to your cart yet.</p>
                  <a href="/products" class="shop-now-btn">Start Shopping</a>
                </div>
                <% } %>
          </div>

          <!-- Order Summary Sidebar -->
          <aside class="summary-column">
            <div class="summary-card">
              <h2 class="summary-title">Order Summary</h2>

              <div class="summary-details">
                <div class="summary-row">
                  <span class="row-label">Subtotal</span>
                  <span class="row-value" id="subtotal">₹<%= subtotal %></span>
                </div>
                <div class="summary-row">
                  <span class="row-label">Delivery Fee</span>
                  <span class="row-value <%= deliveryFee === 'Free' ? 'free' : '' %>" id="deliveryFee">
                    <%= deliveryFee %>
                  </span>
                </div>
                <hr class="summary-divider">
                <div class="summary-row total-row">
                  <span class="row-label">Total</span>
                  <span class="row-value" id="total">₹<%= total %></span>
                </div>
              </div>

              <% const hasOutOfStock=cartItems.some(item=> item.outOfStock); %>
                <button class="checkout-submit-btn" id="checkoutBtn" onclick="location.href='/checkout'"
                  <%=(hasOutOfStock || cartItems.length===0) ? 'disabled' : '' %>>
                  <%= (hasOutOfStock && cartItems.length> 0) ? 'Remove Out of Stock items' : 'Go to Checkout' %>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                      stroke-linecap="round" stroke-linejoin="round">
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                      <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                </button>
            </div>
          </aside>
        </div>

        <!-- Pagination Section -->
        <%- include('../partials/pagination', { pagination, query: '' }) %>
      </main>

      <%- include('../partials/footer') %>

        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="/js/users/cartList.js"></script>
</body>

</html>