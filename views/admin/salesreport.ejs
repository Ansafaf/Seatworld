<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Report - Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/js/admin/common.js"></script>
</head>

<body class="font-display bg-gray-50 text-gray-800">
    <%- include('../partials/flash') %>
        <!-- Top Header -->
        <header class="bg-white shadow-sm fixed w-full z-50 h-16 flex items-center justify-between px-6">
            <div class="flex items-center gap-4">
                <button id="mobileMenuBtn" class="md:hidden text-gray-500 hover:text-gray-700">
                    <span class="material-icons-outlined">menu</span>
                </button>
                <h1 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                    <span class="w-3 h-3 bg-gray-800 rounded-sm"></span>
                    Admin Panel
                </h1>
            </div>
            <div class="flex items-center gap-8">
                <nav class="hidden md:flex items-center gap-6 text-sm font-medium text-gray-600">
                    <a href="/admin/dashboard" class="hover:text-indigo-600 transition-colors">Dashboard</a>
                    <a href="/admin/products" class="hover:text-indigo-600 transition-colors">Products</a>
                    <a href="/admin/orders" class="hover:text-indigo-600 transition-colors">Orders</a>
                    <a href="/admin/users" class="hover:text-indigo-600 transition-colors">Customers</a>
                </nav>
                <div class="flex items-center gap-3 pl-6 border-l border-gray-200">
                    <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden">
                        <img src="https://ui-avatars.com/api/?name=Admin&background=random" alt="Admin"
                            class="w-full h-full object-cover">
                    </div>
                    <div class="flex items-center gap-3 pl-6 border-l border-gray-200">
                        <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden">
                            <img src="https://ui-avatars.com/api/?name=Admin&background=random" alt="Admin"
                                class="w-full h-full object-cover">
                        </div>
                    </div>
        </header>

        <div class="flex pt-16 min-h-screen">
            <!-- Sidebar -->
            <%- include('../partials/adminSidebar') %>

                <!-- Overlay -->
                <div id="sidebarOverlay" class="fixed inset-0 bg-black/20 z-30 hidden md:hidden backdrop-blur-sm"></div>

                <!-- Main Content -->
                <main class="flex-1 p-8 overflow-y-auto bg-white/50">
                    <div class="max-w-7xl mx-auto">
                        <!-- Header Section -->
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                            <div>
                                <h1 class="text-2xl font-bold text-gray-800">Sales Dashboard</h1>
                                <p class="text-gray-500 text-sm mt-1">Analyze sales performance and trends</p>
                            </div>
                            <button onclick="downloadReport()"
                                class="inline-flex items-center justify-center px-4 py-2.5 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors shadow-sm gap-2">
                                <span class="material-icons-outlined text-lg">download</span>
                                Download Report
                            </button>
                        </div>

                        <!-- Stats Grid -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <!-- Total Sales -->
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <div class="text-sm font-medium text-gray-500 mb-1">Total Sales</div>
                                <div class="text-2xl font-bold text-gray-900">
                                    ₹<%= salesData && salesData.totalSales ?
                                        salesData.totalSales.toLocaleString('en-IN') : '0' %>
                                </div>
                            </div>

                            <!-- Avg Order Value -->
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <div class="text-sm font-medium text-gray-500 mb-1">Avg. Order Value</div>
                                <div class="text-2xl font-bold text-gray-900">
                                    ₹<%= salesData && salesData.avgOrderValue ?
                                        salesData.avgOrderValue.toLocaleString('en-IN') : '0' %>
                                </div>
                            </div>

                            <!-- Total Orders -->
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <div class="text-sm font-medium text-gray-500 mb-1">Total Orders</div>
                                <div class="text-2xl font-bold text-gray-900">
                                    <%= salesData && salesData.totalOrders ?
                                        salesData.totalOrders.toLocaleString('en-IN') : '0' %>
                                </div>
                            </div>

                            <!-- CAC -->
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <div class="text-sm font-medium text-gray-500 mb-1">Acquisition Cost</div>
                                <div class="text-2xl font-bold text-gray-900">
                                    ₹<%= salesData && salesData.customerAcquisitionCost ?
                                        salesData.customerAcquisitionCost.toLocaleString('en-IN') : '0' %>
                                </div>
                            </div>
                        </div>

                        <!-- Charts Layout -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Sales Trend -->
                            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h3 class="text-lg font-bold text-gray-800 mb-4">Sales Trend</h3>
                                <div class="flex items-baseline gap-2 mb-6">
                                    <span class="text-3xl font-bold text-indigo-600">
                                        ₹<%= salesData && salesData.last12MonthsSales ?
                                            salesData.last12MonthsSales.toLocaleString('en-IN') : '0' %>
                                    </span>
                                    <span class="text-sm text-gray-500">Last 12 Months</span>
                                </div>

                                <!-- Simplified Chart Placeholder (keeping original logic visualization) -->
                                <div
                                    class="h-64 bg-indigo-50 rounded-lg relative overflow-hidden flex items-end justify-between px-4 pb-0 pt-8 gap-2">
                                    <!-- Visual bars mock -->
                                    <div class="w-full h-[30%] bg-indigo-200 rounded-t"></div>
                                    <div class="w-full h-[45%] bg-indigo-300 rounded-t"></div>
                                    <div class="w-full h-[35%] bg-indigo-200 rounded-t"></div>
                                    <div class="w-full h-[60%] bg-indigo-400 rounded-t"></div>
                                    <div class="w-full h-[50%] bg-indigo-300 rounded-t"></div>
                                    <div class="w-full h-[75%] bg-indigo-500 rounded-t"></div>
                                    <div class="w-full h-[65%] bg-indigo-400 rounded-t"></div>
                                    <div class="w-full h-[85%] bg-indigo-600 rounded-t"></div>
                                    <div class="w-full h-[70%] bg-indigo-500 rounded-t"></div>
                                    <div class="w-full h-[90%] bg-indigo-600 rounded-t"></div>
                                    <div class="w-full h-[80%] bg-indigo-500 rounded-t"></div>
                                    <div class="w-full h-[95%] bg-indigo-600 rounded-t"></div>
                                </div>
                                <div class="flex justify-between text-xs text-gray-400 mt-2 px-1">
                                    <span>Jan</span><span>Feb</span><span>Mar</span><span>Apr</span><span>May</span><span>Jun</span>
                                    <span>Jul</span><span>Aug</span><span>Sep</span><span>Oct</span><span>Nov</span><span>Dec</span>
                                </div>
                            </div>

                            <!-- Top Products -->
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h3 class="text-lg font-bold text-gray-800 mb-4">Top Selling</h3>
                                <div class="flex items-baseline gap-2 mb-6">
                                    <span class="text-2xl font-bold text-gray-900">
                                        ₹<%= salesData && salesData.lastMonthTopProductsSales ?
                                            salesData.lastMonthTopProductsSales.toLocaleString('en-IN') : '0' %>
                                    </span>
                                    <span class="text-sm text-gray-500">Last Month</span>
                                </div>

                                <div class="space-y-4">
                                    <% if (topProducts && topProducts.length> 0) { %>
                                        <% topProducts.forEach(product=> { %>
                                            <div class="flex items-center gap-3">
                                                <div
                                                    class="w-10 h-10 rounded-lg bg-gray-100 overflow-hidden flex-shrink-0">
                                                    <% if (product.image) { %>
                                                        <img src="<%= product.image %>" alt="<%= product.name %>"
                                                            class="w-full h-full object-cover">
                                                        <% } else { %>
                                                            <div
                                                                class="w-full h-full flex items-center justify-center text-gray-400">
                                                                <span
                                                                    class="material-icons-outlined text-sm">image</span>
                                                            </div>
                                                            <% } %>
                                                </div>
                                                <div class="flex-1 min-w-0">
                                                    <p class="text-sm font-medium text-gray-900 truncate">
                                                        <%= product.name %>
                                                    </p>
                                                    <p class="text-xs text-gray-500">
                                                        <%= product.unitsSold %> units sold
                                                    </p>
                                                </div>
                                                <div class="text-sm font-semibold text-gray-900">
                                                    ₹<%= product.revenue.toLocaleString('en-IN') %>
                                                </div>
                                            </div>
                                            <% }); %>
                                                <% } else { %>
                                                    <div class="text-center py-4 text-gray-500 text-sm">No sales data
                                                        available
                                                    </div>
                                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
        </div>

        <script src="/js/admin/salesReport.js"></script>
</body>

</html>